<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>S33R Security News Feed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Security news feed by clivoa, powered by prebuilt JSON + public RSS sources." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="minimal-navbar">
  

  <div class="minimal-dropdown">
    <span class="minimal-nav-link dropdown-toggle">Insights ▾</span>
    <div class="dropdown-menu">
      <a href="archive.html">Archive List</a>
      <a href="archive-overview.html">Year Overview</a>
      <a href="trend.html">Trend Analytics</a>
    </div>
  </div>
</div>

  <div class="page">
    <header class="site-header">
      <div class="site-title-block">
        <div class="badge badge-live">LIVE FEED</div>
        <h1 class="site-title">S33R Security News Feed</h1>
        <p class="site-subtitle muted">
          Curated security news from multiple public RSS sources, pre-aggregated as JSON and rendered with filters, search, and smart groups.
        </p>
      </div>
    </header>

    <main class="layout">
      <aside class="sidebar">
        <section class="sidebar-section">
          <h2 class="sidebar-title">Categories</h2>
          <div id="category-filters" class="pill-group">
            <button class="pill pill-active" data-type="all">All</button>
            <button class="pill" data-type="curated">Curated</button>
            <button class="pill" data-type="crypto">Crypto</button>
            <button class="pill" data-type="cybercrime">Cybercrime, Darknet</button>
            <button class="pill" data-type="dfir">DFIR</button>
            <button class="pill" data-type="general">General Security</button>
            <button class="pill" data-type="government">Government, CERT</button>
            <button class="pill" data-type="leaks">Leaks</button>
            <button class="pill" data-type="malware">Malware</button>
            <button class="pill" data-type="threat_intel">Threat Intel</button>
            <button class="pill" data-type="malware_analysis">Malware Analysis</button>
            <button class="pill" data-type="osint">OSINT, Communities</button>
            <button class="pill" data-type="podcasts">Podcasts</button>
            <button class="pill" data-type="vendors">Vendors</button>
            <button class="pill" data-type="vulns">Vulnerabilities, CVEs</button>
            <button class="pill" data-type="exploits">Exploits</button>
            <button class="pill" data-type="vuln_advisories">Vulnerability Advisories</button>
          </div>
        </section>

        <section class="sidebar-section">
          <h2 class="sidebar-title">Smart groups</h2>
          <p class="sidebar-help">
            Items are automatically tagged based on keywords in title and summary
            (e.g., Ransomware, Exploit / PoC, Threat Actors / APT, Cloud / SaaS).
          </p>
        </section>
      </aside>

      <section class="main-content">
        <section class="filters-bar">
          <div class="filters-left">
            <label for="news-search-input" class="filter-label">Search</label>
            <div class="search-input-wrapper">
              <input
                id="news-search-input"
                type="text"
                class="filter-input"
                placeholder="Search for 0-day, threat actor, CVE-2024-XXXX..."
              />
              <button id="news-search-btn" class="btn-primary">Search</button>
            </div>
          </div>

          <div class="filters-right">
            <div class="filter-group">
              <label for="sort-select" class="filter-label">Sort</label>
              <select id="sort-select" class="filter-input">
                <option value="latest" selected>Latest first</option>
                <option value="oldest">Oldest first</option>
                <option value="source">Source (A–Z)</option>
              </select>
            </div>

            <div class="filter-group recent-only-group">
              <label class="checkbox-label">
                <input id="recent-only-checkbox" type="checkbox" checked />
                <span>Recent only (last 24 hours)</span>
              </label>
            </div>
          </div>
        </section>

        <section class="status-bar">
          <div class="status-left">
            <span class="status-title">Latest headlines</span>
            <span id="stats-text" class="status-meta"></span>
          </div>
          <div class="status-right">
            <span id="generated-info" class="status-meta"></span>
          </div>
        </section>

        <section>
          <div id="loading-indicator" class="loading">
            <div class="spinner"></div>
            <span>Loading news from JSON cache...</span>
          </div>
          <div id="news-list" class="news-list"></div>
        </section>
      </section>
    </main>
    <footer class="site-footer">
      <p>
        S33R Security News Feed<br>
        <span class="muted">Powered by JSON cache + public RSS sources</span>
      </p>
    </footer>
  </div>

  <script>
    const NEWS_JSON_URL = "data/news_recent.json";

    const TYPE_LABELS = {
      crypto: "Crypto",
      cybercrime: "Cybercrime, Darknet",
      dfir: "DFIR",
      general: "General Security",
      government: "Government, CERT",
      leaks: "Leaks",
      malware: "Malware",
      threat_intel: "Threat Intel",
      malware_analysis: "Malware Analysis",
      osint: "OSINT, Communities",
      podcasts: "Podcasts",
      vendors: "Vendors",
      vulns: "Vulnerabilities, CVEs",
      exploits: "Exploits",
      vuln_advisories: "Vulnerability Advisories",
    };

    const state = {
      allItems: [],
      filteredItems: [],
      visibleCount: 0,
      batchSize: 30,
      category: "all",
      search: "",
      sort: "latest",
      recentOnly: true,
      daysBack: 30,
      generatedAt: null,
    };

    function formatDate(ts) {
      if (!ts) return "Unknown date";
      const d = new Date(ts * 1000);
      return d.toLocaleString(undefined, {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    function createSmartGroupBadges(item) {
      const groups = item.smart_groups || [];
      if (!groups.length) return null;

      const container = document.createElement("div");
      container.className = "smart-groups";

      groups.forEach((label) => {
        const badge = document.createElement("span");
        badge.className = "smart-group-badge";
        badge.textContent = label;
        container.appendChild(badge);
      });

      return container;
    }

    function createNewsCard(item) {
      const card = document.createElement("article");
      card.className = "card";

      const top = document.createElement("div");
      top.className = "card-top";

      const src = document.createElement("span");
      src.className = "card-source";
      src.textContent = item.source || "Unknown source";

      const metaRight = document.createElement("div");
      metaRight.className = "card-meta-right";

      if (item.type) {
        const categoryBadge = document.createElement("span");
        categoryBadge.className = "card-category";
        const label = TYPE_LABELS[item.type] || item.type;
        categoryBadge.textContent = label;
        metaRight.appendChild(categoryBadge);
      }

      const dateSpan = document.createElement("span");
      dateSpan.className = "card-date";
      if (item.published_ts) {
        dateSpan.textContent = formatDate(item.published_ts);
      } else {
        dateSpan.textContent = "Unknown date";
      }
      metaRight.appendChild(dateSpan);

      top.appendChild(src);
      top.appendChild(metaRight);

      const titleEl = document.createElement("h2");
      titleEl.className = "card-title";

      const titleLink = document.createElement("a");
      titleLink.className = "card-title-link";
      titleLink.href = item.link || "#";
      titleLink.target = "_blank";
      titleLink.rel = "noopener noreferrer";
      titleLink.textContent = item.title || "Untitled";

      titleEl.appendChild(titleLink);


      const body = document.createElement("div");
      body.className = "card-body";

      const summaryEl = document.createElement("p");
      summaryEl.className = "card-body-text";
      summaryEl.textContent = item.summary || "No summary available.";
      body.appendChild(summaryEl);

      const smartGroupsEl = createSmartGroupBadges(item);
      if (smartGroupsEl) {
        body.appendChild(smartGroupsEl);
      }

      const footer = document.createElement("div");
      footer.className = "card-footer";

      const btn = document.createElement("a");
      btn.className = "btn-link";
      btn.href = item.link || "#";
      btn.target = "_blank";
      btn.rel = "noopener noreferrer";
      btn.textContent = "Read full article";

      footer.appendChild(btn);

      card.appendChild(top);
      card.appendChild(titleEl);
      card.appendChild(body);
      card.appendChild(footer);

      return card;
    }

    function updateStats() {
      const total = state.filteredItems.length;
      const shown = Math.min(state.visibleCount, total);
      const statsEl = document.getElementById("stats-text");
      statsEl.textContent = total
        ? `Showing ${shown} of ${total} items`
        : "No results for current filters.";

      const genInfo = document.getElementById("generated-info");
      if (state.generatedAt) {
        const d = new Date(state.generatedAt);
        genInfo.textContent = `JSON generated at ${d.toLocaleString()} (window: last ${state.daysBack} days)`;
      } else {
        genInfo.textContent = "";
      }
    }
        // Mapeia categorias -> palavras-chave esperadas nos smart_groups
        // Mapeia categorias da sidebar -> palavras-chave usadas nas SMART_GROUP_RULES do Python
    // A ideia é manter aqui o mesmo "espírito" de cada smart group.
    const CATEGORY_SMARTGROUP_RULES = {
      // -------- Vulnerabilities / CVEs --------
      // Espelha o smart group "Vulnerabilities / CVEs"
      vulns: [
        "cve-",
        "vulnerability",
        "vulnerabilities",
        "remote code execution",
        "rce",
        "privilege escalation",
        "buffer overflow",
        "out-of-bounds write",
        "sql injection",
        "authentication bypass",
        "zero-day",
        "0day",
      ],

      // -------- Exploit / PoC --------
      // Espelha o smart group "Exploit / PoC"
      exploits: [
        "exploit",
        "poc released",
        "proof-of-concept",
        "exploit code",
        "weaponized",
        "exploit available",
        "exploit toolkit",
        "exploit released",
      ],

      // -------- Vulnerability Advisories --------
      // Normalmente ligado a boletins e updates oficiais
      vuln_advisories: [
        "security advisory",
        "security bulletin",
        "patch tuesday",
        "security update",
        "cumulative update",
        "vendor advisory",
      ],

      // -------- Crypto / Web3 --------
      // Próximo de um smart group tipo "Crypto / Web3"
      crypto: [
        "blockchain",
        "web3",
        "smart contract",
        "defi",
        "dex",
        "exchange",
        "wallet",
        "token",
        "nft",
        "airdrops",
        "rug pull",
        "bridge exploit",
      ],

      // -------- Cybercrime, Darknet --------
      // Próximo de um smart group "Cybercrime / Darknet & Leaks"
      cybercrime: [
        "darknet",
        "dark web",
        "marketplace",
        "ransomware gang",
        "ransom gang",
        "initial access broker",
        "data leak site",
        "leak site",
        "underground forum",
        "crimeware",
        "credential stuffing",
      ],

      // -------- DFIR --------
      // Próximo de um smart group "DFIR / Forensics"
      dfir: [
        "dfir",
        "forensics",
        "memory analysis",
        "timeline analysis",
        "incident response",
        "artifact",
        "mft",
        "prefetch",
        "dfrws",
      ],

      // -------- General Security --------
      // Bem amplo, pega tópicos genéricos de segurança
      general: [
        "cybersecurity",
        "information security",
        "infosec",
        "security posture",
        "security program",
        "risk management",
      ],

      // -------- Government, CERT --------
      // Próximo de um smart group "Government / CERT / National CSIRT"
      government: [
        "cert-",
        "csirt",
        "gov",
        "government",
        "cisa",
        "enisa",
        "nist",
        "nsa",
        "national cyber",
      ],

      // -------- Leaks --------
      // Próximo de um smart group "Data Breaches / Leaks"
      leaks: [
        "data breach",
        "breach",
        "customer data",
        "stolen data",
        "leaked database",
        "leaked data",
        "breached records",
        "database leak",
        "compromised data",
      ],

      // -------- Malware --------
      // Próximo de um smart group "Malware / Payloads"
      malware: [
        "malware",
        "ransomware",
        "trojan",
        "backdoor",
        "botnet",
        "infostealer",
        "loader",
        "wiper",
        "remote access trojan",
        "rat ",
        "payload",
        "locker",
      ],

      // -------- Threat Intel --------
      // Próximo de "Threat Actors / APT", "Campaigns", etc.
      threat_intel: [
        "apt ",
        "nation-state",
        "state-sponsored",
        "threat actor",
        "actor group",
        "campaign",
        "tactics, techniques and procedures",
        "ttp",
        "ioc",
        "indicator of compromise",
        "mitre atta&ck",
      ],

      // -------- Malware Analysis --------
      // Próximo de "Malware Analysis / Reverse Engineering"
      malware_analysis: [
        "reverse engineering",
        "static analysis",
        "dynamic analysis",
        "sandbox analysis",
        "yara rule",
        "unpack",
        "disassembly",
        "debugger",
        "emulation",
      ],

      // -------- OSINT, Communities --------
      osint: [
        "osint",
        "open-source intelligence",
        "community project",
        "github repo",
        "threat hunting community",
        "slack workspace",
        "discord community",
      ],

      // -------- Podcasts --------
      podcasts: [
        "podcast",
        "episode",
        "listen",
        "audio only",
        "show notes",
      ],

      // -------- Vendors --------
      // Próximo de "Vendors / Products"
      vendors: [
        "vendor",
        "product update",
        "security appliance",
        "endpoint security",
        "siem",
        "xdr",
        "edr",
        "ngfw",
        "cloud security product",
        // nomes típicos podem aparecer aqui também:
        "microsoft",
        "google cloud",
        "aws",
        "azure",
        "palo alto",
        "crowdstrike",
        "cisco",
        "fortinet",
        "checkpoint",
      ],

      // Outras categorias como "curated" e "all" são tratadas
      // diretamente na lógica do applyFilters, então não entram aqui.
    };


    
    function applyFilters(resetVisible) {
      const cat = state.category;
      const search = state.search.trim().toLowerCase();
      const recentOnly = state.recentOnly;

      const now = Date.now() / 1000;
      const ONE_DAY = 24 * 60 * 60;
      const cutoff = now - ONE_DAY;

      let result = state.allItems.filter((item) => {
        // --- filtro por categoria / curated ---
        if (cat === "curated") {
          // Curated: usa campo booleano
          if (!item.curated) {
            return false;
          }
        } else if (cat !== "all") {
          const typeMatch = item.type === cat;

          // Match via smart_groups (Exploits, Vulns, etc.)
          let smartMatch = false;
          const rules = CATEGORY_SMARTGROUP_RULES[cat];
          const groups = item.smart_groups || [];

          if (rules && groups.length) {
            const sgText = groups.join(" ").toLowerCase();
            smartMatch = rules.some((kw) => sgText.includes(kw.toLowerCase()));
          }

          if (!typeMatch && !smartMatch) {
            return false;
          }
        }

        // --- filtro "Recent only" (últimas 24h) ---
        if (recentOnly && item.published_ts && item.published_ts < cutoff) {
          return false;
        }

        // --- filtro de busca ---
        if (search) {
          const hay = [
            item.title || "",
            item.summary || "",
            item.source || "",
          ]
            .join(" ")
            .toLowerCase();

          if (!hay.includes(search)) {
            return false;
          }
        }

        return true;
      });

      if (state.sort === "latest") {
        result.sort((a, b) => (b.published_ts || 0) - (a.published_ts || 0));
      } else if (state.sort === "oldest") {
        result.sort((a, b) => (a.published_ts || 0) - (b.published_ts || 0));
      } else if (state.sort === "source") {
        result.sort((a, b) => (a.source || "").localeCompare(b.source || ""));
      }

      state.filteredItems = result;

      if (resetVisible) {
        state.visibleCount = Math.min(state.batchSize, state.filteredItems.length);
      }

      renderList();
      updateStats();
    }



    function renderList() {
      const listEl = document.getElementById("news-list");
      listEl.innerHTML = "";

      const total = state.filteredItems.length;
      const limit = Math.min(state.visibleCount, total);

      for (let i = 0; i < limit; i++) {
        const item = state.filteredItems[i];
        const card = createNewsCard(item);
        listEl.appendChild(card);
      }

      const loadingEl = document.getElementById("loading-indicator");
      loadingEl.classList.add("hidden");
    }

    function handleScroll() {
      const listEl = document.getElementById("news-list");
      const scrollContainer = window;

      const scrollTop = scrollContainer.scrollY || scrollContainer.pageYOffset || 0;
      const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
      const rect = listEl.getBoundingClientRect();
      const offsetTop = rect.top + scrollTop;

      const distanceFromBottom = offsetTop + listEl.offsetHeight - (scrollTop + viewportHeight);

      if (distanceFromBottom < 300) {
        if (state.visibleCount < state.filteredItems.length) {
          state.visibleCount += state.batchSize;
          renderList();
          updateStats();
        }
      }
    }

    // --- Debounce para busca live ---
    let searchDebounceTimer = null;
    function debounceSearch(callback, delay = 250) {
      if (searchDebounceTimer) {
        clearTimeout(searchDebounceTimer);
      }
      searchDebounceTimer = setTimeout(callback, delay);
    }


    function initEvents() {
      // Category pills
      const catContainer = document.getElementById("category-filters");
      catContainer.addEventListener("click", (ev) => {
        const btn = ev.target.closest("button[data-type]");
        if (!btn) return;
        const type = btn.getAttribute("data-type");

        Array.from(catContainer.querySelectorAll("button[data-type]")).forEach((b) => {
          b.classList.toggle("pill-active", b === btn);
        });

        state.category = type || "all";
        applyFilters(true);
      });

      // Search
            // Search (live, enquanto digita)
      const searchInput = document.getElementById("news-search-input");
      const searchBtn = document.getElementById("news-search-btn");

      function doSearch() {
        state.search = searchInput.value || "";
        applyFilters(true);
      }

      // Busca dinâmica enquanto digita, com debounce
      searchInput.addEventListener("input", () => {
        debounceSearch(() => {
          doSearch();
        }, 250); // ajusta o delay se quiser mais rápido/lento
      });

      // Botão de busca continua funcionando (opcional)
      searchBtn.addEventListener("click", (e) => {
        e.preventDefault();
        doSearch();
      });


      // Recent only
      const recentCheckbox = document.getElementById("recent-only-checkbox");
      recentCheckbox.addEventListener("change", () => {
        state.recentOnly = !!recentCheckbox.checked;
        applyFilters(true);
      });

      // Sort
      const sortSelect = document.getElementById("sort-select");
      sortSelect.addEventListener("change", () => {
        state.sort = sortSelect.value || "latest";
        applyFilters(true);
      });

      // Infinite scroll
      window.addEventListener("scroll", handleScroll);
    }

    async function init() {
      const loadingEl = document.getElementById("loading-indicator");
      loadingEl.classList.remove("hidden");

      try {
        const res = await fetch(NEWS_JSON_URL);
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();

        state.daysBack = data.days_back || 30;
        state.generatedAt = data.generated_at || null;
        state.allItems = Array.isArray(data.items) ? data.items : [];

        // Normalize types for safety
        state.allItems.forEach((item) => {
          if (!item.type && item.type_label) {
            item.type = item.type_label.toLowerCase().replace(/s+/g, "_");
          }
        });

        applyFilters(true);
        initEvents();
      } catch (err) {
        console.error("Failed to load news JSON", err);
        loadingEl.classList.add("hidden");
        const listEl = document.getElementById("news-list");
        listEl.innerHTML = "";
        const errCard = document.createElement("div");
        errCard.className = "card";
        const p = document.createElement("p");
        p.className = "card-body-text";
        p.textContent = "Error while loading news feeds. Please try again later.";
        errCard.appendChild(p);
        listEl.appendChild(errCard);
      }
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
